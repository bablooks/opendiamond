#!@PYTHON@

from distutils.command.build_py import build_py
from distutils.core import setup
import os

class opendiamond_build_py(build_py):
    def build_packages(self):
	build_py.build_packages(self)
	# Rewrite opendiamond/__init__.py to contain the software version
	origfile = os.path.join(self.get_package_dir('opendiamond'),
			'__init__.py')
	newfile = self.get_module_outfile(self.build_lib, ['opendiamond'],
			'__init__')
	fh = open(newfile, 'w')
	fh.write("__version__ = '@VERSION@'\n")
	fh.close()
	# Set the __init__.py utimes to those of the source file to prevent
	# file conflicts when installing both 32-bit and 64-bit RPM packages
	st = os.stat(origfile)
	os.utime(newfile, (st.st_atime, st.st_mtime))


setup(
    name = "opendiamond",
    version = "@VERSION@",
    packages = [
	'dataretriever',
	'opendiamond',
	'opendiamond.filter',
	'opendiamond.server',
	'scopeserver_flickr',
	'scopeserver_gatekeeper',
	'scopeserver_vmfind',
    ],
    scripts = [
	'@srcdir@/tools/cookiecutter',
	'@srcdir@/tools/dataretriever',
	'@srcdir@/tools/diamondd',
	'@srcdir@/tools/diamond-bundle-python',
	# volcano is not installed
    ],
    package_dir = { '': '@srcdir@' },
    package_data = {
	'scopeserver_flickr':	  [ 'templates/*.html' ],
	'scopeserver_gatekeeper': [ 'templates/*.html' ],
	'scopeserver_vmfind':	  [ 'templates/*.html' ],
    },
    author = "OpenDiamond project, Carnegie Mellon University",
    author_email = "diamond@cs.cmu.edu",
    description = "OpenDiamond",
    license = "Eclipse Public License, Version 1.0",
    keywords = "opendiamond non-indexed search",
    url = "http://diamond.cs.cmu.edu/",
    cmdclass = {'build_py': opendiamond_build_py},
)
