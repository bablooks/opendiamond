\input{texcam}
\usepackage{times}
\usepackage{mathptm}

\newcommand{\rw}[1]{{\em #1}}

\title{Programing Diamond: Overview }
\author{
}

\begin{document}

\maketitle


\section{Overview}
\label{overview}

This document provides an overview of the different APIs for
writing and Diamond application.  
Figure~\ref{fig:arch} illustrates the Diamond
architecture.  Diamond separates the \emph{front end}, which encapsulates
domain-specific application code on the host computer, from the \emph{back
end}, which consists of a domain-independent infrastructure that is
common across a wide range of search applications.


\begin{figure}[tbp]
\includegraphics[width=0.5\linewidth]{diamond_arch}
\caption{Diamond Architecture}
\label{fig:arch}
\end{figure}

A Diamond application runs on the host computer and interacts with
the user to formulate a query.  Once a query has been formulated, the
application translates the query into a set of machine executable tasks
(termed a \emph{searchlet}) that the storage devices use to
filter out data that does not match the search criteria.  The searchlet
contains all of the domain-specific knowledge and acts as a proxy
for the application (and the user).
                                                                                
The searchlet consists of a set of \emph{filters} and some
configuration state (\emph{e.g.}, filter parameters).  The searchlet
diamond runtime evaluates the  evaluate the searchlets on each of the disks

\section{Searchlet API}
\input{searchlet_api.tex}


\section{Searchlets}
\label{searchlets}

A searchlet is composed of filter functions (which are passed as
binary images) and a secification

 function) as well as 
a specification of how the filters should be run.  

The filters are compiled functions that are passed as a shared library.
These functions are loaded into the runtie on the active storage
device.

The fitler specification contains  specifices which filters
to instantiate.  A filter is an instance of the binary function along
with the its arguments.  The application can also specify additional
arguments by giving a blob of data that is loaded into
the address space of each of the functions during initialization
time.


\subsection{Filter Specification}

The filter specification is a text file that specifies the each of the filter
s to be instantiated.  Each filter is given a unique name.  The filter
spec then 

\begin{itemize}

\item \begin{verbatim}FILTER <name>\end{verbatim}

This keyword starts marks the beginning of a new filter
section (and the end of a previous one).  The name argument is a string
that is the symbolic name for the filter.  The name can consist of
alphanumeric characters as well as - and \_.

\item \begin{verbatim} FILTER_INIT_FUNCTION <function name> \end{verbatim}

This is the name of the initialization function used
to generate the arguments that are going to be passed to
the filter function.  This should be the symbol name of the 
function in the library that is passed as part of the searchlet.

If not initialization function is provided, then a
NULL will be passed as an argument to the filter function.

\item \begin{verbatim} FILTER_EVAL_FUNCTION <function name> \end{verbatim}

This is the name filter function that is used
to process objects.  This function will take an 
object as an argument and return a integer.  This 
integer is compared to the threshold to determine if it
is interesting or not.


\item \begin{verbatim} FILTER_FINI_FUNCTION <function name> \end{verbatim}

This is the name of the function in the shared library that is used
to clean up any arguments (free memory) after the the searchlet
has been run.  

\item \begin{verbatim} REQUIRES <name list> \end{verbatim}

This is an optional argument that gives a list of 1 or more
filters that must be run before this filter can be executed.

\item \begin{verbatim} ARG <string> \end{verbatim}



\item \begin{verbatim} THRESHOLD <threshold value> \end{verbatim}

This is the threshold value to be used for passing or dropping the object.
When the filter returns it will return an integer value that is compared
to the threshold.  If the value is greater than or equal to the threshold,
then diamond will continue passing the object.  Values less than
the threshold will indicate the object is not interesting.


\item \begin{verbatim} IN_OBJECT <block_size> \end{verbatim}

This is a mandatory characteristic that indicates the block size that
the application will use for accessing the object contents.

\item \verb#OUT_OBJECT	<modifier>	<block_size>#

The OUT\_OBJECT specifies characteristics of the object(s) generated by the 
by the filter.  The block size, is the natural size of the writes
that the filter will use when writing data to the object. The 
modifier flags indicates how the system should create the object
base on the input object.   


The modifier can be one of the following tokens: UNMODIFIED, NEW, CLONE,
COPY\_ATTR.

The UNMODIFIED token indicates the the filter will not modify
the input object contents (it can write attributes).  The
NEW token indicates the output object will be a brandnew object with
none of the attributes or data from the input object.
The CLONE attribute specifies the output object is a copy
of the original object (before any applications writes into
it).  The COPY\_ATTR give an object with no data portion but
has inherits all of the attributes from in input object. 

At least one OUT\_OBJECT must be declared for each filter.

\item \verb#MERIT	<int>#

The merit gives an application provided hint hint on how useful
this filter is at eliminating data.  The run-time can use
these hints to provide initial ordering of filters. A lower number
indicates the filter is more effective at eliminating data
than higher numbers. 

\end{itemize}
\subsection{Filter Functions}

In addition to the filter spec, the searchlet consists of binary code
containing the filter functions.  These are the functions declared




\section{Filter Library}





\end{document}
