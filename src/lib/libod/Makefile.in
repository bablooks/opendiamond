#
#      Diamond (Release 1.0)
#      A system for interactive brute-force search
#
#      Copyright (c) 2002-2005, Intel Corporation
#      All Rights Reserved
#
#  This software is distributed under the terms of the Eclipse Public
#  License, Version 1.0 which can be found in the file named LICENSE.
#  ANY USE, REPRODUCTION OR DISTRIBUTION OF THIS SOFTWARE CONSTITUTES
#  RECIPIENT'S ACCEPTANCE OF THIS AGREEMENT
#

ROOTDIR = @top_srcdir@
SRCDIR = @srcdir@
VPATH = @srcdir@
OBJROOT = @OBJROOT@


SRVOBJS = od_svc.o  od_server.o od_xdr.o
SRVSRC = od_svc.c  od_server.c od_xdr.c

TEST_OBJS = otest.o od_clnt.o od_xdr.o
TEST_SRCS = otest.c od_clnt.c od_xdr.c

APITEST_OBJS = apitest.o 
APITEST_SRCS = apitest.c 

LIBOBJS = od_api.o od_clnt.o od_xdr.o od_lookup.o
LIBSRCS = od.h od_api.c od_clnt.c od_xdr.c od_lookup.c

OBJS = $(LIBOBJS) $(TEST_OBJS) $(APITEST_OBJS) $(SRVOBJS)
SRCS = $(LIBSRCS) $(TEST_SRCS) $(APITEST_SRCS) $(SRVSRC)

RPCGEN_SRCS = od.h od_svc.c od_xdr.c od_clnt.c

SHARED_BIN = od_server populate-disk.pl apitest

LIBS += -lodisk  -ltools -ldconfig -lpthread -ldctl -llog -lssl -lcrypto

APILIBS += -lod -ltools -ldconfig
APILIBDIR += -L../libod -L../libtools -L../libdconfig

TARGETS = od.h libod.a od_server otest apitest

CLEAN_OTHERS += $(RPCGEN_SRCS) ./od.x ./lib_od.h

include $(OBJROOT)/Makefile.template 


#
# There are some problems with rpcgen that I havn't
# figured out. if you don't compile in the local directory
# it adds absolute path names and doesn't find includes.
# this is a bug hack for now ...
$(RPCGEN_SRCS): od.x_src
	cp -fuv $<  od.x
	cp -fuv $(<D)/lib_od.h lib_od.h
	rpcgen od.x


od_server: od.h $(SRVOBJS) 
	$(CC) $(CFLAGS) -o od_server $(SRVOBJS) $(LIBDIR) $(LIBS)

otest: od.h $(TEST_OBJS) 
	$(CC) $(CFLAGS) -o otest $(TEST_OBJS) 

apitest: od.h $(APITEST_OBJS) 
	$(CC) $(CFLAGS) -o apitest $(APITEST_OBJS) $(APILIBDIR) $(APILIBS)

