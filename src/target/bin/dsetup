#!/bin/sh

# read the configuration information
. ./remote.config

BINFILES="adiskd"

copybin()
{
	for disk in $DISKLIST; do
		for bin in $BINFILES; do
			scp $bin ${REMOTEUSER}@${disk}:${BINPATH}/
		done
	done
}

remotesetup()
{
	for disk in $DISKLIST; do
      		ssh -x ${REMOTEUSER}@${disk} "mkdir -p ${BINPATH}"
	done
}

install()
{
	remotesetup
	copybin
	#remote_configure
}


shutdown()
{
	for disk in $DISKLIST; do
      		ssh -x ${REMOTEUSER}@${disk} "killall -q -s 9 adiskd"
	done
}

start()
{
	shutdown
	for disk in $DISKLIST; do
		ssh -x ${REMOTEUSER}@${disk} "${BINPATH}/adiskd -s"
	done
}



#
# Parse the commands to see what we should do.
#
case "$1" in
  start)
    echo -n "Starting Daemons: "
    start
    echo "done."
    ;;
                                                                                
  stop)
    echo -n "Stopping Daemons: "
    shutdown
    echo "done."
    ;;
  
  install)
    echo -n "Installing ... "
    shutdown
    echo "done."
    ;;
                                                                                
  *)
    echo "Usage: dsetup {start|stop|install}"
    exit 1
    ;;
esac

exit 0
