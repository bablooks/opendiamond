<!--
/*
 *  The OpenDiamond Platform for Interactive Search
 *  Version 3
 *
 *  Copyright (c) 2007 Intel Corporation
 *  All rights reserved.
 *
 *  This software is distributed under the terms of the Eclipse Public
 *  License, Version 1.0 which can be found in the file named LICENSE.
 *  ANY USE, REPRODUCTION OR DISTRIBUTION OF THIS SOFTWARE CONSTITUTES
 *  RECIPIENT'S ACCEPTANCE OF THIS AGREEMENT
 */
-->
<?php
    $form_url = $G['WEBROOT'] . "/index.php?action=manage";
    $all_users = $a->list_users();
    $all_collections = array_keys($a->get_collections());
    sort($all_users);
    sort($all_collections);
?>
<form action="<?php echo $form_url; ?>" method="POST">
<select name="username" id="username">
<option value=""<?php if (!$username) { echo " selected"; } ?>>New user</option>
<?php
    foreach ($all_users as $user) {
	echo "<option";
	if ($username == $user) {
	    echo " selected";
	}
	print ">$user</option>\n";
    }
?>
</select>
<input type="text" name="username" />
<ul>
<?php foreach ($all_collections as $coll) { ?>
    <li><input type="checkbox" name="coll[]" value="<?php echo $coll; ?>" />
    <?php echo $coll; ?></li>
<?php } ?>
</ul>
<input type="submit" value="Update" />
</form>
<script type="text/javascript">
var membership = {
<?php
    foreach ($all_users as $user) {
	print "\"$user\":{";
	$collections = $a->member_of($user);
	foreach ($collections as $coll) {
	    print "\"$coll\":1,";
	}
	print "},\n";
    }
?>
};
function updateCollections(username) {
    var ismember = membership[username] || {};
    if (username != "") {
	$("input:text").fadeOut("slow");
    } else {
	$("input:text").fadeIn("slow");
    }
    $("input:checkbox").attr("checked", function () {
	return ismember[this.value] && "checked" || "";
    });
}
$(function () {
    $("select#username")
	.change(function () { updateCollections(this.value); })
	.change();
});
</script>
